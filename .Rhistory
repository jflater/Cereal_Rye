theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank())
# Concentration plot with sample events overlayed
conc_plot <- ggplot(filtered_data(), aes(x = date)) +
geom_line(aes(y = approx_nitrate_mg_l, color = "Interpolated Nitrate"), size = 1) +
geom_line(aes(y = approx_ammonia_mg_l, color = "Interpolated Ammonia"),
size = 1, linetype = "dashed") +
geom_point(data = filtered_data() %>% dplyr::filter(sample_y_n == "Y"),
aes(y = nitrate_mg_ml, color = "Measured Nitrate"),
shape = 16, size = 2) +
geom_point(data = filtered_data() %>% dplyr::filter(sample_y_n == "Y"),
aes(y = ammonia_mg_l, color = "Measured Ammonia"),
shape = 17, size = 2) +
geom_vline(data = filtered_data() %>% dplyr::filter(sample_y_n == "Y"),
aes(xintercept = as.numeric(date)),
color = "red", linetype = "dotted", alpha = 0.5) +
labs(x = "Date", y = "Concentration",
title = "Nutrient Concentrations with Sampling Events",
color = "Legend") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Combine the two plots vertically
combined_plot <- plot_grid(flow_plot, conc_plot, ncol = 1, align = "v", rel_heights = c(1, 1))
# Convert to an interactive Plotly object
ggplotly(combined_plot)
})
}
# Run the application
shinyApp(ui, server)
ui <- fluidPage(
titlePanel("Interactive Plot Selector"),
sidebarLayout(
sidebarPanel(
selectInput("plot_select", "Select Plot:",
choices = sort(unique(n_loss_2023$plot)))
),
mainPanel(
plotlyOutput("combinedPlot")
)
)
)
server <- function(input, output, session) {
output$combinedPlot <- renderPlotly({
# Filter data for the selected plot
filtered_data <- n_loss_2023 %>% filter(plot == input$plot_select)
# Create flow plot
flow_plot <- ggplot(filtered_data, aes(x = date, y = flow_l)) +
geom_col(fill = "skyblue", color = "black", alpha = 0.7) +
labs(x = NULL,
y = "Flow (L)",
title = "Daily Flow") +
theme_minimal() +
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank())
# Create concentration plot with sampling events overlay
conc_plot <- ggplot(filtered_data, aes(x = date)) +
geom_line(aes(y = approx_nitrate_mg_l, color = "Interpolated Nitrate"), size = 1) +
geom_line(aes(y = approx_ammonia_mg_l, color = "Interpolated Ammonia"),
size = 1, linetype = "dashed") +
geom_point(data = filtered_data %>% dplyr::filter(sample_y_n == "Y"),
aes(y = nitrate_mg_ml, color = "Measured Nitrate"),
shape = 16, size = 2) +
geom_point(data = filtered_data %>% dplyr::filter(sample_y_n == "Y"),
aes(y = ammonia_mg_l, color = "Measured Ammonia"),
shape = 17, size = 2) +
geom_vline(data = filtered_data %>% dplyr::filter(sample_y_n == "Y"),
aes(xintercept = as.numeric(date)),
color = "red", linetype = "dotted", alpha = 0.5) +
labs(x = "Date", y = "Concentration",
title = "Nutrient Concentrations with Sampling Events",
color = "Legend") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Convert each ggplot object to an interactive Plotly object
flow_plotly <- ggplotly(flow_plot)
conc_plotly <- ggplotly(conc_plot)
# Combine using subplot, sharing the x-axis
subplot(flow_plotly, conc_plotly, nrows = 2, shareX = TRUE, titleY = TRUE)
})
}
shinyApp(ui, server)
View(df_interpolated)
library(readxl)
library(janitor)
library(lubridate)
library(tidyverse)
# From my PC:
#raw_X2024_SABR_MASTER_water <- read_excel("C:/Users/jflater/Box/McDaniel Lab 2.0/Projects/SABR_TileWater_Studt/2024/2024_SABR_MASTER_water.xlsm")
#raw_SABR_tile_MASTER_pre2024 <- read_excel("C:/Users/jflater/Box/McDaniel Lab 2.0/Projects/SABR_TileWater_Studt/2019-2023/SABR_tile_MASTER_pre2024.xlsx")
# From my Mac:
# SABR_tile_MASTER_pre2024 <- read_excel("../../Box-Box/McDaniel Lab 2.0/Projects/SABR_TileWater_Studt/2019-2023/SABR_tile_MASTER_pre2024.xlsx")
# X2024_SABR_MASTER_water <- read_excel("../../Box-Box/McDaniel Lab 2.0/Projects/SABR_TileWater_Studt/2024/2024_SABR_MASTER_water.xlsm")
#
# colnames(X2024_SABR_MASTER_water)
#
# colnames(SABR_tile_MASTER_pre2024)
#
# # save both as .csv in data/raw
#
# write_csv(X2024_SABR_MASTER_water, "data/raw/X2024_SABR_MASTER_water.csv")
# write_csv(SABR_tile_MASTER_pre2024, "data/raw/SABR_tile_MASTER_pre2024.csv")
SABR_tile_MASTER_pre2024 <- read_csv("data/raw/SABR_tile_MASTER_pre2024.csv")
X2024_SABR_MASTER_water <- read_csv("data/raw/X2024_SABR_MASTER_water.csv")
# 2023 data
df_2023 <- SABR_tile_MASTER_pre2024 %>%
mutate(date = as.Date(date, format = "%Y%m%d")) %>%
select(sample_id, date, plot, nitrate_ppm = no3_mg_l, ammonia_ppm = nh4_mg_l)
# 2024 data
df_2024 <- X2024_SABR_MASTER_water %>%
separate(lab_id, into = c("date", "plot"), sep = "_", remove = FALSE) %>%
mutate(date = as.Date(date, format = "%Y%m%d")) %>%
select(date, plot, nitrate_ppm, ammonia_ppm)
# Combine 2023 and 2024 data
df <- bind_rows(df_2023, df_2024)
nrow(df_2023) + nrow(df_2024) == nrow(df)
# Many NAs in 2023 data, we are missing the plot and date, but we have sample_id
# Check this file for date and plot
read_xlsx("C:/Users/jflater/Box/CABBI/Data/MeasuredData/SABR/SmallDrainagePlots/Drainage/meter data/TileDrainage_2023.xlsx") %>%
anyNA()
studt_2023 <- read_xlsx("C:/Users/jflater/Box/CABBI/Data/MeasuredData/SABR/SmallDrainagePlots/Drainage/meter data/TileDrainage_2023.xlsx") %>%
clean_names() %>%
mutate(date = as.Date(as.character(date), format = "%Y%m%d"),
sample_id = as.double(sample_id))
glimpse(studt_2023)
glimpse(df_2023)
# join studt_2023 to df by date and plot, keep all rows
temp <- df_2023 %>%
left_join(studt_2023, by = c("sample_id"))
water_n_2023 <- temp %>%
dplyr::filter(year(date.y) == 2023 & !plot.y %in% c("NE", "SE", "SW", "NW")) %>%
select(plot = plot.y, date = date.y, nitrate_mg_ml = nitrate_ppm, ammonia_mg_l = ammonia_ppm, sample_y_n)
write_csv(water_n_2023, "data/clean/water_n_2023.csv")
# 2024 data
studt_2024 <- read_xls("C:/Users/jflater/Box/CABBI/Data/MeasuredData/SABR/SmallDrainagePlots/Drainage/meter data/TileDrainage_2024.xls") %>%
clean_names()
# 2024 data
studt_2024 <- read_xls("C:/Users/jflater/Box/CABBI/Data/MeasuredData/SABR/SmallDrainagePlots/Drainage/meter data/TileDrainage_2024.xls") %>%
clean_names()
# 2024 data
studt_2024 <- read_xls("C:/Users/jflater/Box/CABBI/Data/MeasuredData/SABR/SmallDrainagePlots/Drainage/meter data/TileDrainage_2024.xlsx") %>%
clean_names()
# 2024 data
studt_2024 <- read_xls("C:/Users/jflater/Box/CABBI/Data/MeasuredData/SABR/SmallDrainagePlots/Drainage/meter data/TileDrainage_2024.xlsx") %>%
clean_names()
library(readxl)
TileDrainage_2024 <- read_excel("C:/Users/jflater/Box/CABBI/Data/MeasuredData/SABR/SmallDrainagePlots/Drainage/meter data/TileDrainage_2024.xlsx")
View(TileDrainage_2024)
# 2024 data
studt_2024 <- read_xlsx("C:/Users/jflater/Box/CABBI/Data/MeasuredData/SABR/SmallDrainagePlots/Drainage/meter data/TileDrainage_2024.xlsx") %>%
clean_names()
View(studt_2024)
colnames(studt_2024)
# 2024 data
studt_2024 <- read_xlsx("C:/Users/jflater/Box/CABBI/Data/MeasuredData/SABR/SmallDrainagePlots/Drainage/meter data/TileDrainage_2024.xlsx") %>%
clean_names() %>%
mutate(date = as.Date(as.character(date), format = "%Y%m%d"),
sample_id = as.double(sample_id))
View(studt_2024)
View(df_2024)
View(df_2024)
# 2024 data
df_2024 <- X2024_SABR_MASTER_water %>%
separate(lab_id, into = c("date", "plot"), sep = "_", remove = FALSE) %>%
mutate(date = as.Date(date, format = "%Y%m%d")) %>%
select(sample_number, date, plot, nitrate_ppm, ammonia_ppm)
View(studt_2024)
compare_df_cols(studt_2024, df_2024)
# 2024 data
df_2024 <- X2024_SABR_MASTER_water %>%
separate(lab_id, into = c("date", "plot"), sep = "_", remove = FALSE) %>%
mutate(date = as.Date(date, format = "%Y%m%d")) %>%
select(sample_id = sample_number, date, plot, nitrate_ppm, ammonia_ppm)
# 2024 data
df_2024 <- X2024_SABR_MASTER_water %>%
separate(lab_id, into = c("date", "plot"), sep = "_", remove = FALSE) %>%
mutate(date = as.Date(date, format = "%Y%m%d")) %>%
select(sample_id = sample_number, everything())
# 2024 data
df_2024 <- X2024_SABR_MASTER_water %>%
separate(lab_id, into = c("date", "plot"), sep = "_", remove = FALSE) %>%
mutate(date = as.Date(date, format = "%Y%m%d"),
sample_number = as.integer(sample_number)) %>%
select(sample_id = sample_number, everything())
compare_df_cols(studt_2024, df_2024)
# 2024 data
studt_2024 <- read_xlsx("C:/Users/jflater/Box/CABBI/Data/MeasuredData/SABR/SmallDrainagePlots/Drainage/meter data/TileDrainage_2024.xlsx") %>%
clean_names() %>%
mutate(date = as.Date(as.character(date), format = "%Y%m%d"),
sample_id = as.interger(sample_id))
# 2024 data
studt_2024 <- read_xlsx("C:/Users/jflater/Box/CABBI/Data/MeasuredData/SABR/SmallDrainagePlots/Drainage/meter data/TileDrainage_2024.xlsx") %>%
clean_names() %>%
mutate(date = as.Date(as.character(date), format = "%Y%m%d"),
sample_id = as.integer(sample_id))
# join studt_2024 to df_2024 by sample_id, keep all rows
temp_2024 <- df_2024 %>%
left_join(studt_2024, by = c("sample_id"))
View(temp_2024)
# join studt_2024 to df_2024 by sample_id, keep all rows
temp_2024 <- df_2024 %>%
dplyr::filter(!plot %in% c("NE", "SE", "SW", "NW")) %>%
left_join(studt_2024, by = c("sample_id"))
View(temp_2024)
# join studt_2024 to df_2024 by sample_id, keep all rows
temp_2024 <- df_2024 %>%
dplyr::filter(!plot %in% c("NE", "SE", "SW", "NW")) %>%
select(-matches("^\\.\\.[0-9]+$")) %>%
left_join(studt_2024, by = c("sample_id"))
View(temp_2024)
View(df_2024)
View(studt_2024)
# join studt_2024 to df_2024 by sample_id, keep all rows
temp_2024 <- df_2024 %>%
dplyr::filter(!plot %in% c("NE", "SE", "SW", "NW")) %>%
select(-matches("^\\.\\.[0-9]+$")) %>%
left_join(studt_2024, by = c("sample_id"))
# join studt_2024 to df_2024 by sample_id, keep all rows
temp_2024 <- df_2024 %>%
dplyr::filter(!plot %in% c("NE", "SE", "SW", "NW")) %>%
select(-matches("^\\.\\.\\.[0-9]+$")) %>%
left_join(studt_2024, by = c("sample_id"))
# Do all rows have values in nitrate_ppm and ammonia_ppm?
anyNA(temp_2024$nitrate_ppm) # FALSE
anyNA(temp_2024$ammonia_ppm) # FALSE
# What row?
temp_2024 %>%
dplyr::filter(is.na(nitrate_ppm) | is.na(ammonia_ppm))
# According to comments ok to remove, remove that row
temp_2024 <- temp_2024 %>%
dplyr::filter(!is.na(nitrate_ppm) & !is.na(ammonia_ppm))
# Any rows with N in sample_y_n?
temp_2024 %>%
dplyr::filter(sample_y_n == "N")
# Any rows with N in sample_y_n?
temp_2024 <- temp_2024  %>%
dplyr::filter(sample_y_n == "N") %>%
mutate(plot.y = case_when(
sample_y_n == "N" & plot.y == "4" ~ "09",
TRUE ~ plot.y
))
# join studt_2024 to df_2024 by sample_id, keep all rows
temp_2024 <- df_2024 %>%
dplyr::filter(!plot %in% c("NE", "SE", "SW", "NW")) %>%
select(-matches("^\\.\\.\\.[0-9]+$")) %>%
left_join(studt_2024, by = c("sample_id"))
# Do all rows have values in nitrate_ppm and ammonia_ppm?
anyNA(temp_2024$nitrate_ppm) # FALSE
anyNA(temp_2024$ammonia_ppm) # FALSE
# What row?
temp_2024 %>%
dplyr::filter(is.na(nitrate_ppm) | is.na(ammonia_ppm))
# According to comments ok to remove, remove that row
temp_2024 <- temp_2024 %>%
dplyr::filter(!is.na(nitrate_ppm) & !is.na(ammonia_ppm))
# Any rows with N in sample_y_n?
temp_2024 <- temp_2024  %>%
mutate(plot.y = case_when(
sample_y_n == "N" & plot.y == "4" ~ "09",
TRUE ~ plot.y
))
water_n_2024 <- temp_2024 %>%
select(plot = plot.y, date = date.y, nitrate_ppm, ammonia_ppm)
View(water_n_2024)
# Save
write_csv(water_n_2024, "data/clean/water_n_2024.csv")
gc()
gc()
# Calculate N-loss in tile drainage from SABR small plots
library(tidyverse)
library(janitor)
library(zoo)
library(ggplot2)
# 2023
flow <- read_csv("data/clean/2023_2024_SABR_tile_flow.csv") %>%
clean_names() %>%
mutate(plot = as.factor(str_remove(plot, "^0+")))
n_conc <- read_csv("data/clean/water_n_2023.csv") %>%
clean_names() %>%
mutate(plot = as.factor(plot))
compare_df_cols(flow, n_conc)
# join n_conc to flow
flow_n <- flow %>%
left_join(n_conc, by = c("plot", "date"))
# 2024 concentrations
conc_2024 <-
read_csv("data/clean/water_n_2024.csv") %>%
clean_names() %>%
mutate(plot = as.factor(plot))
compare_df_cols(flow_n, conc_2024)
# join 2024 concentrations to flow_n
flow_n <- flow_n %>%
left_join(conc_2024, by = c("plot", "date"))
View(flow_n)
n_conc_24 <- read_csv("data/clean/water_n_2024.csv") %>%
clean_names() %>%
mutate(plot = as.factor(plot))
compare_df_cols(n_conc, n_conc_24)
n_conc_24 <- read_csv("data/clean/water_n_2024.csv") %>%
clean_names() %>%
mutate(plot = as.factor(plot)) %>%
select(nitrate_mg_ml = nitrate_ppm, ammonia_mg_l = ammonia_ppm)
compare_df_cols(n_conc, n_conc_24)
View(n_conc_24)
n_conc_24 <- read_csv("data/clean/water_n_2024.csv") %>%
clean_names() %>%
mutate(plot = as.factor(plot)) %>%
select(date, plot, nitrate_mg_ml = nitrate_ppm, ammonia_mg_l = ammonia_ppm)
compare_df_cols(n_conc, n_conc_24)
n_conc <- read_csv("data/clean/water_n_2023.csv") %>%
clean_names() %>%
mutate(plot = as.factor(plot)) %>%
select(!sample_y_n)
n_conc_24 <- read_csv("data/clean/water_n_2024.csv") %>%
clean_names() %>%
mutate(plot = as.factor(plot)) %>%
select(date, plot, nitrate_mg_ml = nitrate_ppm, ammonia_mg_l = ammonia_ppm)
compare_df_cols(n_conc, n_conc_24)
# Calculate N-loss in tile drainage from SABR small plots
library(tidyverse)
library(janitor)
library(zoo)
library(ggplot2)
# 2023
flow <- read_csv("data/clean/2023_2024_SABR_tile_flow.csv") %>%
clean_names() %>%
mutate(plot = as.factor(str_remove(plot, "^0+")))
n_conc_23 <- read_csv("data/clean/water_n_2023.csv") %>%
clean_names() %>%
mutate(plot = as.factor(plot)) %>%
select(!sample_y_n)
n_conc_24 <- read_csv("data/clean/water_n_2024.csv") %>%
clean_names() %>%
mutate(plot = as.factor(plot)) %>%
select(date, plot, nitrate_mg_ml = nitrate_ppm, ammonia_mg_l = ammonia_ppm)
compare_df_cols(n_conc_23, n_conc_24)
compare_df_cols(flow, n_conc)
n_conc <- cbind(n_conc, n_conc_24)
gc()
# Calculate N-loss in tile drainage from SABR small plots
library(tidyverse)
library(janitor)
library(zoo)
library(ggplot2)
# 2023
flow <- read_csv("data/clean/2023_2024_SABR_tile_flow.csv") %>%
clean_names() %>%
mutate(plot = as.factor(str_remove(plot, "^0+")))
n_conc_23 <- read_csv("data/clean/water_n_2023.csv") %>%
clean_names() %>%
mutate(plot = as.factor(plot)) %>%
select(!sample_y_n)
n_conc_24 <- read_csv("data/clean/water_n_2024.csv") %>%
clean_names() %>%
mutate(plot = as.factor(plot)) %>%
select(date, plot, nitrate_mg_ml = nitrate_ppm, ammonia_mg_l = ammonia_ppm)
compare_df_cols(n_conc_23, n_conc_24)
n_conc <- cbind(n_conc_23, n_conc_24)
n_conc <- rbind(n_conc_23, n_conc_24)
View(n_conc)
compare_df_cols(flow, n_conc)
flow_n <- flow %>%
left_join(n_conc, by = c("plot", "date"))
View(flow_n)
library(readxl)
library(janitor)
library(lubridate)
library(tidyverse)
# From my PC:
#raw_X2024_SABR_MASTER_water <- read_excel("C:/Users/jflater/Box/McDaniel Lab 2.0/Projects/SABR_TileWater_Studt/2024/2024_SABR_MASTER_water.xlsm")
#raw_SABR_tile_MASTER_pre2024 <- read_excel("C:/Users/jflater/Box/McDaniel Lab 2.0/Projects/SABR_TileWater_Studt/2019-2023/SABR_tile_MASTER_pre2024.xlsx")
# From my Mac:
# SABR_tile_MASTER_pre2024 <- read_excel("../../Box-Box/McDaniel Lab 2.0/Projects/SABR_TileWater_Studt/2019-2023/SABR_tile_MASTER_pre2024.xlsx")
# X2024_SABR_MASTER_water <- read_excel("../../Box-Box/McDaniel Lab 2.0/Projects/SABR_TileWater_Studt/2024/2024_SABR_MASTER_water.xlsm")
#
# colnames(X2024_SABR_MASTER_water)
#
# colnames(SABR_tile_MASTER_pre2024)
#
# # save both as .csv in data/raw
#
# write_csv(X2024_SABR_MASTER_water, "data/raw/X2024_SABR_MASTER_water.csv")
# write_csv(SABR_tile_MASTER_pre2024, "data/raw/SABR_tile_MASTER_pre2024.csv")
SABR_tile_MASTER_pre2024 <- read_csv("data/raw/SABR_tile_MASTER_pre2024.csv")
X2024_SABR_MASTER_water <- read_csv("data/raw/X2024_SABR_MASTER_water.csv")
# 2023 data
df_2023 <- SABR_tile_MASTER_pre2024 %>%
mutate(date = as.Date(date, format = "%Y%m%d")) %>%
select(sample_id, date, plot, nitrate_ppm = no3_mg_l, ammonia_ppm = nh4_mg_l)
# 2024 data
df_2024 <- X2024_SABR_MASTER_water %>%
separate(lab_id, into = c("date", "plot"), sep = "_", remove = FALSE) %>%
mutate(date = as.Date(date, format = "%Y%m%d"),
sample_number = as.integer(sample_number)) %>%
select(sample_id = sample_number, everything())
# Combine 2023 and 2024 data
df <- bind_rows(df_2023, df_2024)
nrow(df_2023) + nrow(df_2024) == nrow(df)
# Many NAs in 2023 data, we are missing the plot and date, but we have sample_id
# Check this file for date and plot
read_xlsx("C:/Users/jflater/Box/CABBI/Data/MeasuredData/SABR/SmallDrainagePlots/Drainage/meter data/TileDrainage_2023.xlsx") %>%
anyNA()
studt_2023 <- read_xlsx("C:/Users/jflater/Box/CABBI/Data/MeasuredData/SABR/SmallDrainagePlots/Drainage/meter data/TileDrainage_2023.xlsx") %>%
clean_names() %>%
mutate(date = as.Date(as.character(date), format = "%Y%m%d"),
sample_id = as.double(sample_id))
glimpse(studt_2023)
glimpse(df_2023)
# join studt_2023 to df by date and plot, keep all rows
temp <- df_2023 %>%
left_join(studt_2023, by = c("sample_id"))
water_n_2023 <- temp %>%
dplyr::filter(year(date.y) == 2023 & !plot.y %in% c("NE", "SE", "SW", "NW")) %>%
select(plot = plot.y, date = date.y, nitrate_mg_ml = nitrate_ppm, ammonia_mg_l = ammonia_ppm, sample_y_n)
write_csv(water_n_2023, "data/clean/water_n_2023.csv")
# 2024 data
studt_2024 <- read_xlsx("C:/Users/jflater/Box/CABBI/Data/MeasuredData/SABR/SmallDrainagePlots/Drainage/meter data/TileDrainage_2024.xlsx") %>%
clean_names() %>%
mutate(date = as.Date(as.character(date), format = "%Y%m%d"),
sample_id = as.integer(sample_id))
compare_df_cols(studt_2024, df_2024)
# join studt_2024 to df_2024 by sample_id, keep all rows
temp_2024 <- df_2024 %>%
dplyr::filter(!plot %in% c("NE", "SE", "SW", "NW")) %>%
select(-matches("^\\.\\.\\.[0-9]+$")) %>%
left_join(studt_2024, by = c("sample_id"))
# Do all rows have values in nitrate_ppm and ammonia_ppm?
anyNA(temp_2024$nitrate_ppm) # FALSE
anyNA(temp_2024$ammonia_ppm) # FALSE
# What row?
temp_2024 %>%
dplyr::filter(is.na(nitrate_ppm) | is.na(ammonia_ppm))
# According to comments ok to remove, remove that row
temp_2024 <- temp_2024 %>%
dplyr::filter(!is.na(nitrate_ppm) & !is.na(ammonia_ppm))
# Any rows with N in sample_y_n?
temp_2024 <- temp_2024  %>%
mutate(plot.y = case_when(
sample_y_n == "N" & plot.y == "4" ~ "09",
TRUE ~ plot.y
))
water_n_2024 <- temp_2024 %>%
select(plot = plot.y, date = date.y, nitrate_ppm, ammonia_ppm)
# Save
write_csv(water_n_2024, "data/clean/water_n_2024.csv")
View(temp_2024)
water_n_2024 <- temp_2024 %>%
select(plot = plot.y, date = date.y, nitrate_ppm, ammonia_ppm, sample_y_n)
# Save
write_csv(water_n_2024, "data/clean/water_n_2024.csv")
n_conc_24 <- read_csv("data/clean/water_n_2024.csv") %>%
clean_names() %>%
mutate(plot = as.factor(plot)) %>%
select(date, plot, nitrate_mg_ml = nitrate_ppm, ammonia_mg_l = ammonia_ppm, sample_y_n)
compare_df_cols(n_conc_23, n_conc_24)
n_conc_23 <- read_csv("data/clean/water_n_2023.csv") %>%
clean_names() %>%
mutate(plot = as.factor(plot))
compare_df_cols(n_conc_23, n_conc_24)
n_conc <- rbind(n_conc_23, n_conc_24)
compare_df_cols(flow, n_conc)
flow_n <- flow %>%
left_join(n_conc, by = c("plot", "date"))
View(flow_n)
# convert flow to liters from gallons
flow_n <- flow_n %>%
mutate(flow_l = flow_gallons * 3.78541)
# linear interpolation of concentrations
df_interpolated <- flow_n %>%
group_by(plot) %>%
arrange(date) %>%
mutate(approx_nitrate_mg_l = na.approx(nitrate_mg_ml, x = date, na.rm = FALSE),
approx_ammonia_mg_l = na.approx(ammonia_mg_l, x = date, na.rm = FALSE)) %>%
ungroup()
# Save a .csv
write_csv(df_interpolated, "data/clean/2023_2024_SABR_tile_flow_n.csv")
df_interpolated <- read_csv("data/clean/2023_2024_SABR_tile_flow_n.csv")
library(tidyverse)
flow_data <- read_csv("data/clean/2023_2024_SABR_tile_flow_n.csv")
getwd()
flow_data <- read_csv("data/clean/2023_2024_SABR_tile_flow_n.csv")
library(tidyverse)
flow_data <- read_csv("data/clean/2023_2024_SABR_tile_flow_n.csv")
setwd(dir = "../../")
flow_data <- read_csv("data/clean/2023_2024_SABR_tile_flow_n.csv")
ggplot(flow_data, aes(x = date, y = flow_l)) +
geom_line(color = "steelblue", size = 1) +
facet_wrap(~ plot, ncol = 2) +
labs(
x = "Date",
y = "Flow (l)") +
theme_minimal()
ggplot(flow_data, aes(x = date, y = flow_l)) +
geom_line(color = "steelblue", linewidth = 1) +
facet_wrap(~ plot, ncol = 2) +
labs(
x = "Date",
y = "Flow (l)") +
theme_minimal()
ggplot(flow_data, aes(x = date, y = flow_l)) +
geom_line(color = "steelblue", linewidth = 1) +
facet_wrap(~ plot, ncol = 3) +
labs(
x = "Date",
y = "Flow (l)") +
theme_minimal()
ggplot(flow_data, aes(x = date, y = flow_l)) +
geom_line(color = "steelblue", linewidth = 1) +
facet_wrap(~ plot, ncol = 3, scales = "free_y") +
labs(
x = "Date",
y = "Flow (l)") +
theme_minimal()
